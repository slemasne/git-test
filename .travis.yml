language: python
python:
  - "3.6"      # current default Python on Travis CI

# command to install dependencies
install:
  - pip install -r requirements.txt

branches:
  only:
  - /^feature.*$/
  - master
  
jobs:
  include:
    - stage: Do some mock tests
      script:
        - python repo_pkg/hello_git.py
    - stage: Run black formatter and commit any changes
      if: branch != master
      script:
        - bash ci_tools/new_commit_with_black.sh



deploy:
  - provider: script
    script: >-
            bash ci_tools/bumpversion.sh &&
            python setup.py sdist bdist_wheel &&
            python -m twine upload --repository testpypi dist/* -u __token__ -p ${PYPI_PW}

    on: master

notifications:
  slack:
    - rooms:
        - slemasne-dev:NedCJg3JF6NOo7faUs41iLfc #failures
      on_success: never
      on_failure: always
      template:
        - "%{repository_slug} (%{commit}) : %{message}"
        - "Build details: %{build_url}"
    - rooms:
        - slemasne-dev:NedCJg3JF6NOo7faUs41iLfc #successes
      on_success: always
      on_failure: never
      on_pull_requests: false
      if: branch = master
      template:
        - "%{repository_slug} (%{commit}) : %{message}"
        - "New version of lusidtools has been published to PyPi:"
        - "https://pypi.org/project/lusidtools/"


